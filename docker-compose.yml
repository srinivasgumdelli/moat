services:
  intel:
    build: .
    env_file: .env
    volumes:
      - ./data:/app/data
      - ./config.yaml:/app/config.yaml:ro
    restart: "no"
    # For claude_code provider: uncomment to mount Claude CLI + auth
    # profiles: [api]  # skip this service when using claude_code locally

  ollama:
    image: ollama/ollama:latest
    profiles: [local-llm]
    volumes:
      - ollama_data:/root/.ollama
    ports:
      - "11434:11434"
    restart: unless-stopped

  scheduler:
    image: mcuadros/ofelia:latest
    depends_on: [intel]
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    labels:
      ofelia.job-exec.intel-morning.schedule: "0 6 * * *"
      ofelia.job-exec.intel-morning.container: "intel"
      ofelia.job-exec.intel-morning.command: "python -m intel run"
      ofelia.job-exec.intel-evening.schedule: "0 18 * * *"
      ofelia.job-exec.intel-evening.container: "intel"
      ofelia.job-exec.intel-evening.command: "python -m intel run"

volumes:
  ollama_data:
