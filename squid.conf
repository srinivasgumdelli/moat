# Squid forward proxy for Moat devcontainer
# Domain whitelist — all other outbound traffic is blocked

http_port 3128
access_log none
cache_log /var/log/squid/cache.log

# Disable caching (filtering only, not caching)
cache deny all

# ACL definitions
acl SSL_ports port 443
acl CONNECT method CONNECT

# Domain whitelist
# GitHub
acl allowed_domains dstdomain .github.com
acl allowed_domains dstdomain .githubusercontent.com
acl allowed_domains dstdomain .githubassets.com

# npm
acl allowed_domains dstdomain .npmjs.org

# Anthropic
acl allowed_domains dstdomain .anthropic.com

# Sentry (.sentry.io covers sentry.io and all subdomains)
acl allowed_domains dstdomain .sentry.io

# Statsig
acl allowed_domains dstdomain .statsig.com

# VS Code
acl allowed_domains dstdomain marketplace.visualstudio.com
acl allowed_domains dstdomain vscode.blob.core.windows.net
acl allowed_domains dstdomain update.code.visualstudio.com
acl allowed_domains dstdomain .vo.msecnd.net
acl allowed_domains dstdomain .gallerycdn.vsassets.io

# Claude
acl allowed_domains dstdomain .claude.ai
acl allowed_domains dstdomain .claude.com

# Terraform (provider registry, releases — belt-and-suspenders, init runs on host)
acl allowed_domains dstdomain .registry.terraform.io
acl allowed_domains dstdomain .releases.hashicorp.com
acl allowed_domains dstdomain .checkpoint-api.hashicorp.com

# Python (PyPI)
acl allowed_domains dstdomain .pypi.org
acl allowed_domains dstdomain .pythonhosted.org

# Go
acl allowed_domains dstdomain proxy.golang.org
acl allowed_domains dstdomain sum.golang.org
acl allowed_domains dstdomain .go.dev

# Tool proxy (host-side)
acl allowed_domains dstdomain host.docker.internal

# Access rules
http_access deny CONNECT !SSL_ports
http_access allow allowed_domains
http_access deny all
